<!doctype html>
<html lang="es" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport"
        content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no">
  <title>Acceso ‚Äî Seguimiento O&M</title>
  <meta name="description" content="P√°gina de inicio de sesi√≥n previa al m√≥dulo Seguimiento O&M.">

  <!-- üîí Si ya hay sesi√≥n activa, redirige de inmediato (evita FOUC) -->
  <script>
    (function () {
      try {
        if (sessionStorage.getItem('auth_ok')) {
          // replace() evita volver al login con el bot√≥n Atr√°s
          window.location.replace('main_page.html');
        }
      } catch (e) {}
    })();
  </script>

  <style>
    :root{
      /* Tema base (Claro) */
      --bg:#f6f8fc; --panel:#ffffff; --text:#0f172a; --muted:#475569;
      --line:#dbe2f1; --primary:#2563eb; --accent:#f59e0b; --shadow:0 22px 48px rgba(15,23,42,.12);

      /* Caja por defecto (desktop/tablet) */
      --card-w: min(560px, calc(100vw - 32px));
      --card-pad-x: clamp(16px, 2.6vmin, 28px);
      --card-pad-y: clamp(14px, 2.4vmin, 24px);

      /* Fondo blur */
      --blur: 5px;
      --bg-img-scale: 1.08;
      --bg-img-bright: 0.96;
      --bg-img-opacity: 0.55;

      /* Touch */
      --tap-h: clamp(44px, 6.2vmin, 52px);
      --radius: 14px;
      --radius-sm: 12px;
      --gap: clamp(10px, 1.8vmin, 14px);
      --fs-base: 16px; /* evita zoom iOS */
      --fs-small: 13px;
      --fs-title: clamp(22px, 2.6vmax, 28px);
    }
    html[data-theme="dark"],
    body.theme-dark{
      --bg:#0e1320;
      --panel:#151a2e;
      --text:#e5eaf5;
      --muted:#9fb0c9;
      --line:#24314f;
      --primary:#6ee7ff;
      --accent:#ffd166;
      --shadow:0 22px 48px rgba(0,0,0,.35);
    }

    /* Reset/Global */
    *{ box-sizing: border-box; -webkit-tap-highlight-color: transparent }
    html,body{ height:100%; margin:0 }
    body{
      color:var(--text); background:var(--bg);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial;
      font-size: var(--fs-base);
      line-height: 1.35;
      overflow:hidden;
    }
    a{ color:var(--primary); text-decoration:none }
    img{ display:block; max-width:100%; height:auto }

    /* ===== Fondo con la misma imagen (usa svh y safe areas) ===== */
    .bg{
      position: fixed; inset: 0; z-index: -1; overflow:hidden;
      padding: env(safe-area-inset-top) env(safe-area-inset-right)
               env(safe-area-inset-bottom) env(safe-area-inset-left);
      background: var(--bg);
    }
    .bg::before{
      content:""; position:absolute; inset:-8%;
      background-image: url("dominion.jpg");
      background-size: cover; background-position: center;
      filter: blur(var(--blur)) brightness(var(--bg-img-bright));
      opacity: var(--bg-img-opacity);
      transform: scale(var(--bg-img-scale));
    }

    /* ===== Contenedor centrado (svh para m√≥viles con barra din√°mica) ===== */
    .wrap{
      position: fixed; inset: 0;
      height: 100svh; width: 100svw;
      display: grid; place-items: center;
      padding: 16px;
    }

    /* ===== Tarjeta de login ===== */
    .card{
      width: var(--card-w);
      background: color-mix(in srgb, var(--panel) 86%, transparent);
      border: 1px solid var(--line);
      border-radius: 16px;
      box-shadow:
        0 20px 55px rgba(15,23,42,.28),
        0 0 0 1.2px rgba(255,255,255,.45) inset;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: var(--card-pad-y) var(--card-pad-x);
      display: flex; flex-direction: column; gap: var(--gap);
      max-height: min(86svh, 760px);
      overflow: auto;
      scrollbar-gutter: stable both-edges;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      padding:10px; border-radius:var(--radius-sm); background: var(--panel);
      border:1px solid var(--line); box-shadow: var(--shadow);
    }
    .logo{
      width:72px; height:72px; flex: 0 0 72px; border-radius:12px;
      background:#fff; border:1px solid var(--line);
      display:grid; place-items:center; overflow:hidden; padding:8px;
    }
    .logo img{
      width:100%; height:100%;
      object-fit: contain; object-position:center;
      background:#fff; display:block;
    }
    .brand-title{ display:flex; flex-direction:column; line-height:1.05 }
    .brand-title strong{ font-size:14px }
    .brand-title small{ color:var(--muted) }
    .title{ margin: 2px 2px 0; font-size: var(--fs-title); font-weight: 600; letter-spacing:.25px }
    .lead{ margin: 0 2px 6px; color:var(--muted); font-size: clamp(14px, 1.9vmin, 15px) }

    /* ===== Formulario ===== */
    form{ display:flex; flex-direction:column; gap: 12px; margin-top: 6px }
    .field{ display:flex; flex-direction:column; gap:6px }
    .label{ font-size: var(--fs-small); color: var(--muted) }
    .control{ position: relative }
    .input{
      width:100%;
      height: var(--tap-h);
      padding: 0 44px 0 14px;
      border-radius: var(--radius);
      border: 1px solid var(--line);
      background: var(--panel); color: var(--text);
      outline: none;
      transition: border .15s ease, box-shadow .15s ease, background .15s ease;
      box-shadow: 0 0 0 0 rgba(37,99,235,0);
      font-size: 16px; /* evita zoom en iOS */
    }
    .input:focus{
      border-color: color-mix(in srgb, var(--primary) 50%, var(--line));
      box-shadow: 0 0 0 4px color-mix(in srgb, var(--primary) 14%, transparent);
    }

    /* Mostrar/Ocultar password */
    .toggle-pass{
      position:absolute; right:6px; top:50%; transform: translateY(-50%);
      border: 1px solid var(--line);
      background: var(--panel); color: var(--text);
      display:inline-grid; place-items:center;
      width:40px; height:40px; border-radius:12px; cursor:pointer;
    }
    .toggle-pass svg{ width:20px; height:20px; stroke: currentColor; fill:none; stroke-width:2 }

    /* Fila auxiliar */
    .row{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      flex-wrap: wrap;
    }
    .remember{
      display:inline-flex; align-items:center; gap:8px; color: var(--muted); font-size: 14px;
      user-select: none;
    }
    .remember input{ width:18px; height:18px }
    .actions{ display:flex; align-items:center; gap:10px; flex-wrap: wrap }
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      min-height: var(--tap-h);
      padding: 0 16px; border-radius: var(--radius); border:1px solid var(--line);
      background: var(--panel); color: var(--text); cursor:pointer; box-shadow: var(--shadow);
      font-weight:600; font-size: 16px;
      touch-action: manipulation;
    }
    .btn.primary{ background: var(--primary); color:#fff; border-color: transparent }
    .btn:disabled{ opacity:.6; cursor:not-allowed }

    /* Error / estado */
    .alert{
      display:none; padding:12px 12px; border-radius: var(--radius); border:1px solid #ef4444;
      color:#991b1b; background: #fee2e2; font-size: 14px;
    }
    html[data-theme="dark"] .alert{ background: #3f1e1e; color:#fecaca; border-color:#7f1d1d }

    /* Legal */
    .legal{
      margin-top:6px; text-align:center; color:var(--muted); font-size: 12px;
      background: color-mix(in srgb, var(--panel) 82%, transparent);
      padding: 8px 10px; border-radius:10px; border: none; box-shadow: var(--shadow);
      backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);
    }

    /* ===== Ajustes Responsive ===== */
    @media (max-width: 480px){
      :root{
        --card-w: min(100%, calc(100vw - 16px));
        --fs-title: clamp(20px, 5.2vw, 24px);
      }
      .brand{ gap:10px; padding:8px }
      .logo{ width:60px; height:60px }
      .lead{ margin-bottom: 2px }
      .card{ max-height: 92svh }
    }
    @media (min-width: 1200px){
      :root{ --card-w: min(640px, calc(100vw - 48px)) }
      .logo{ width:84px; height:84px; padding:10px }
      .lead{ font-size: 15px }
    }

    /* Soporte para teclados virtuales (evita saltos) */
    @supports (height: 100dvh){
      .wrap{ height: 100dvh; }
      .card{ max-height: min(88dvh, 780px); }
    }

    /* ===== FIX LAPTOP: eliminar scroll interno en la tarjeta ===== */
    /* 1440√ó900 y similares */
    @media (min-width: 1200px) and (max-width: 1536px){
      :root{
        --card-w: min(500px, calc(100vw - 32px)); /* ajustable */
        --card-pad-y: 14px;
        --card-pad-x: 18px;
        --tap-h: 44px;
        --gap: 10px;
        --fs-title: clamp(20px, 2.0vmax, 24px);
      }
      .card{ max-height: calc(100svh - 24px); }
      .brand{ padding: 8px; }
      .logo{ width:66px; height:66px; padding:7px; }
      .lead{ margin-bottom: 4px; }
      .legal{ padding: 6px 8px; }
    }
    /* 1366√ó768 (la m√°s com√∫n) y cercanas */
    @media (min-width: 1024px) and (max-width: 1368px){
      :root{
        --card-w: min(460px, calc(100vw - 26px)); /* ajustable */
        --card-pad-y: 12px;
        --card-pad-x: 16px;
        --tap-h: 42px;
        --gap: 8px;
        --fs-title: clamp(19px, 2.0vmax, 22px);
      }
      .card{ max-height: calc(100svh - 22px); }
      .brand{ padding: 8px; }
      .logo{ width:62px; height:62px; padding:6px; }
      .lead{ margin-bottom: 2px; }
      .legal{ padding: 6px 8px; }
    }

    /* Preferir dvh si est√° disponible para altura exacta del viewport din√°mico */
    @supports (height: 100dvh){
      @media (min-width: 1024px) and (max-width: 1536px){
        .wrap{ height: 100dvh; }
        .card{ max-height: calc(100dvh - 22px); }
      }
    }
  </style>
</head>
<body>
  <!-- Fondo -->
  <div class="bg" aria-hidden="true"></div>

  <!-- Contenedor -->
  <main class="wrap" aria-label="Acceso a Seguimiento O&M">
    <section class="card" role="region" aria-labelledby="tituloAcceso">
      <!-- Marca -->
      <div class="brand">
        <div class="logo" title="DOMINION">
          <img src="dominion_logo.png?v=1" alt="Logo DOMINION">
        </div>
        <div class="brand-title">
          <strong>MinTIC</strong>
          <small>Centros Digitales</small>
        </div>
      </div>

      <h1 class="title" id="tituloAcceso">Accede a Seguimiento O&M</h1>
      <p class="lead">Inicia sesi√≥n para consultar el Dashboard, KPIs y la hoja de vida de los Centros Digitales.</p>

      <!-- Estado / error -->
      <div class="alert" id="alertBox" role="alert" aria-live="polite"></div>

      <!-- Formulario -->
      <form id="loginForm" novalidate>
        <div class="field">
          <label class="label" for="inpUser">Usuario o correo</label>
          <div class="control">
            <input class="input" id="inpUser" name="user" type="text" inputmode="email"
                   autocomplete="username" placeholder="usuario@dominion-global.com" required>
          </div>
        </div>

        <div class="field">
          <label class="label" for="inpPass">Contrase√±a</label>
          <div class="control">
            <input class="input" id="inpPass" name="pass" type="password"
                   autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
            <button class="toggle-pass" type="button" id="btnTogglePass" aria-label="Mostrar u ocultar contrase√±a">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
            </button>
          </div>
        </div>

        <div class="row">
          <label class="remember">
            <input type="checkbox" id="chkRemember">
            Recordarme
          </label>
          <a href="#ayuda" id="linkHelp">¬øNecesitas ayuda?</a>
        </div>

        <div class="actions">
          <button class="btn" type="button" id="btnTheme" title="Cambiar tema">
            <span id="btnThemeText">Tema: Claro</span>
          </button>
          <button class="btn primary" type="submit" id="btnSubmit">Entrar</button>
        </div>
      </form>

      <div class="legal" id="loginLegal">
        ¬© 2026 DOMINION ‚Äî Todos los derechos reservados ‚Äî WEB desarrollada por Ariel M√°rquez Rada
      </div>
    </section>
  </main>

  <script>
    // ===== CONFIGURACI√ìN (multiusuario de demostraci√≥n) =====
    // IMPORTANTE: Solo para DEMO. No usar en producci√≥n (las credenciales quedan visibles).
    const USERS = [
      { user: 'dayana.jimenez@dominion-global.com', email: 'dayana.jimenez@dominion-global.com', pass: 'root2', role: 'admin', redirect: 'main_page.html' },
      { user: 'admin', email: 'ariel.marquez-ext@dominion-global.com', pass: 'root1', role: 'admin', redirect: 'main_page.html' },
      { user: 'operador01', email: 'operador01@dominion-global.com', pass: 'op123456', role: 'viewer', redirect: 'main_page.html' },
      // Agrega m√°s usuarios aqu√≠:
      // { user: 'juan', email: 'juan.perez@dominion-global.com', pass: 'xxxxxx', role: 'viewer', redirect: 'main_page.html' },
    ];
    const DEFAULT_REDIRECT = 'main_page.html';

    // √çndice para b√∫squeda r√°pida por alias o email (case-insensitive)
    const userIndex = new Map();
    for (const u of USERS) {
      if (u.user)  userIndex.set(String(u.user).toLowerCase(), u);
      if (u.email) userIndex.set(String(u.email).toLowerCase(), u);
    }

    // ===== Persistencia de tema (misma clave que tu landing) =====
    (function() {
      const themeKey = 'landing_theme';
      const docEl = document.documentElement;
      const body  = document.body;
      const btn   = document.getElementById('btnTheme');
      const lbl   = document.getElementById('btnThemeText');

      function applyLabel(mode){
        if (lbl) lbl.textContent = 'Tema: ' + (mode === 'dark' ? 'Oscuro' : 'Claro');
      }
      function setMode(mode){
        docEl.setAttribute('data-theme', mode);
        body.classList.toggle('theme-dark', mode==='dark');
        localStorage.setItem(themeKey, mode);
        applyLabel(mode);
      }
      (function initTheme(){
        const saved     = localStorage.getItem(themeKey);
        const theInitial = saved || document.documentElement.getAttribute('data-theme') || 'light';
        setMode(theInitial);
      })();
      btn?.addEventListener('click', () => {
        const cur  = (docEl.getAttribute('data-theme')==='dark') ? 'dark' : 'light';
        const next = (cur==='dark') ? 'light' : 'dark';
        setMode(next);
      });
    })();

    // ===== Mostrar / Ocultar contrase√±a =====
    (function(){
      const btn = document.getElementById('btnTogglePass');
      const inp = document.getElementById('inpPass');
      btn?.addEventListener('click', ()=>{
        if (!inp) return;
        const isPass = inp.type === 'password';
        inp.type = isPass ? 'text' : 'password';
        btn.style.transform = 'translateY(-50%) scale(0.98)';
        setTimeout(()=>{ btn.style.transform = 'translateY(-50%)'; }, 90);
      });
    })();

    // ===== Recordarme (solo usuario) =====
    (function(){
      const KEY  = 'login_saved_user';
      const chk  = document.getElementById('chkRemember');
      const user = document.getElementById('inpUser');

      const saved = localStorage.getItem(KEY);
      if (saved && user){
        user.value = saved;
        chk && (chk.checked = true);
      }
      chk?.addEventListener('change', ()=>{
        if (!user) return;
        if (chk.checked && user.value.trim()){
          localStorage.setItem(KEY, user.value.trim());
        } else {
          localStorage.removeItem(KEY);
        }
      });
      user?.addEventListener('input', ()=>{
        if (chk?.checked){
          const v = user.value.trim();
          if (v) localStorage.setItem(KEY, v);
          else localStorage.removeItem(KEY);
        }
      });
    })();

    // ===== Formulario: validaci√≥n b√°sica y redirecci√≥n =====
    (function(){
      const form = document.getElementById('loginForm');
      const user = document.getElementById('inpUser');
      const pass = document.getElementById('inpPass');
      const btn  = document.getElementById('btnSubmit');
      const box  = document.getElementById('alertBox');
      const help = document.getElementById('linkHelp');

      // Mejora UX: asegurar que el campo enfocado quede centrado (√∫til en pantallas peque√±as)
      function ensureInView(el){
        try{ el?.scrollIntoView({block:'center', behavior:'smooth'}); }catch(e){}
      }
      user?.addEventListener('focus', () => ensureInView(user));
      pass?.addEventListener('focus', () => ensureInView(pass));

      function showError(msg){
        if (!box) return;
        box.textContent = msg;
        box.style.display = 'block';
      }
      function hideError(){
        if (!box) return;
        box.style.display = 'none';
        box.textContent = '';
      }
      help?.addEventListener('click', (e)=>{
        e.preventDefault();
        showError('Si olvidaste tus credenciales, contacta a: ariel.marquez-ext@dominion-global.com');
      });

      form?.addEventListener('submit', (e)=>{
        e.preventDefault();
        hideError();

        const u = (user?.value || '').trim();
        const p = (pass?.value || '').trim();
        if (!u || !p){
          showError('Por favor completa usuario y contrase√±a.');
          return;
        }
        btn.disabled = true;

        // ===== Verificaci√≥n local (demo) usando USERS =====
        setTimeout(() => {
          const key = u.toLowerCase();
          const rec = userIndex.get(key);
          const ok  = !!rec && p === rec.pass;

          if (ok) {
            sessionStorage.setItem('auth_ok', '1');
            sessionStorage.setItem('auth_user', rec.email || rec.user);
            sessionStorage.setItem('auth_role', rec.role || 'viewer');

            /* >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
               NUEVO: Forzar que el popup de bienvenida se muestre
               en este nuevo login (se limpia la marca de la sesi√≥n)
               <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< */
            sessionStorage.removeItem('welcome_shown');

            const dest = rec.redirect || DEFAULT_REDIRECT;
            window.location.assign(dest);
          } else {
            showError('Credenciales inv√°lidas. Intenta nuevamente.');
            btn.disabled = false;
          }
        }, 220);
      });

      // Cerrar teclado m√≥vil al tocar fuera (no afecta laptops)
      document.addEventListener('touchend', (ev)=>{
        const t = ev.target;
        if (!(t instanceof HTMLElement)) return;
        if (!t.closest('.control') && (document.activeElement instanceof HTMLInputElement)){
          document.activeElement.blur();
        }
      }, {passive:true});
    })();

    // Ajuste para redibujar altura cuando cambia la barra del navegador m√≥vil
    window.addEventListener('orientationchange', () => { document.body.offsetHeight; }, {passive:true});
  </script>
</body>
</html>