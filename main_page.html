<!doctype html>
<html lang="es" data-theme="light">
<head>
  <!-- Guard de sesión (no tocar) -->
  <script>
    (function(){
      try{
        if(!sessionStorage.getItem('auth_ok')){
          window.location.replace('login.html');
        }
      }catch(e){
        window.location.replace('login.html');
      }
    })();
  </script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>Seguimiento O&M — Principal</title>
  <meta name="description" content="Página principal de Seguimiento O&M con menú lateral fijo y tema oscuro/claro.">

  <style>
    html[data-theme="light"] #welcomeUser { color: var(--primary); }
    html[data-theme="dark"]  #welcomeUser { color: var(--primary); }

    :root{
      /* ===== Tema base (Claro) ===== */
      --bg:#f6f8fc; --panel:#ffffff; --text:#0f172a; --muted:#475569;
      --line:#dbe2f1; --primary:#2563eb; --accent:#f59e0b;
      --shadow:0 22px 48px rgba(15,23,42,.12);
      --sb-w: 260px; --sb-bg:#ffffff; --sb-line:#dbe2f1;
    }

    /* ===== Modo oscuro (solo variables) ===== */
    html[data-theme="dark"], body.theme-dark{
      --bg:#0e1320; --panel:#151a2e; --text:#e5eaf5; --muted:#9fb0c9;
      --line:#24314f; --primary:#6ee7ff; --accent:#ffd166;
      --shadow:0 22px 48px rgba(0,0,0,.35);
      --sb-bg:#151a2e; --sb-line:#24314f;
    }

    /* Ajuste para laptops (1366–1536) */
    @media (min-width: 1200px) and (max-width: 1536px){
      :root{ --sb-w: 240px; }
    }

    /* ===== Reset/Global ===== */
    *{box-sizing:border-box}
    html,body{height:100%; margin:0}
    body{
      color:var(--text); background:var(--bg);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial;
      overflow:hidden; /* layout app */
    }
    a{color:var(--text); text-decoration:none}
    img{display:block; max-width:100%; height:auto}

    /* ===== SIDEBAR ===== */
    .sidebar{
      position: fixed; inset: 0 auto 0 0; width: var(--sb-w);
      background: color-mix(in srgb, var(--sb-bg) 50%, transparent);
      border: 1px solid var(--sb-line); border-radius: 10px; margin: 5px;
      box-shadow:
        26px 0 75px rgba(15, 23, 42, 0.42),
        0 20px 55px rgba(15, 23, 42, 0.28),
        0 0 0 1.4px rgba(255, 255, 255, 0.55) inset,
        0 0 22px rgba(0, 102, 255, 0.28),
        0 0 44px rgba(0, 102, 255, 0.18);
      backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px);
      padding: 14px 12px; display: flex; flex-direction: column; justify-content: space-between;
      z-index: 200;
    }
    .sb-brand{ display:flex; align-items:center; gap:12px; padding:8px; border-radius:12px; background: var(--panel); border:1px solid var(--line); box-shadow: var(--shadow); }
    .sb-logo{ width:72px; height:72px; flex:0 0 72px; border-radius:14px; background:#fff; border:1px solid var(--line); overflow:hidden; display:grid; place-items:center; padding:8px; }
    .sb-logo img{ width:100%; height:100%; object-fit:contain; object-position:center; background:#fff; }
    @media (min-width: 1200px) and (max-width: 1536px){ .sb-logo{ width:56px; height:56px; padding:6px } }
    @media (max-width: 960px){ .sb-logo{ width:44px; height:44px; padding:4px } }
    [data-theme="dark"] .sb-logo{ background:#fff; border-color: var(--line) }
    .sb-title{ display:flex; flex-direction:column; line-height:1.05 }
    .sb-title strong{ font-size:14px }
    .sb-title small{ color:var(--muted) }

    .sb-section-title{ margin:14px 8px 6px 8px; font-size:11px; letter-spacing:.25px; text-transform:uppercase; color:var(--muted) }
    .sb-nav{ display:flex; flex-direction:column; gap:6px; padding:0 4px }
    .sb-item{
      display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:12px;
      color:var(--text); background:transparent; border:1px solid transparent;
      transition: background .2s, border .2s, transform .06s;
    }
    .sb-item:hover{ background:rgba(37,99,235,.08); border-color: rgba(37,99,235,.18) }
    .sb-item:active{ transform: translateY(1px) }
    .sb-item svg{ width:18px; height:18px; display:block; color: var(--muted); }
    .sb-item svg *{ stroke-linecap: round; stroke-linejoin: round; vector-effect: non-scaling-stroke; }
    .sb-item svg path, .sb-item svg circle, .sb-item svg rect, .sb-item svg line, .sb-item svg polyline, .sb-item svg polygon{ stroke: currentColor; stroke-width:2; fill:none; }
    .sb-item:hover svg{ color: var(--primary); }

    .sb-footer{ display:flex; flex-direction:column; gap:10px; padding:0 4px }
    .btn-logout, .btn-theme{
      display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:12px;
      background: var(--panel); border:1px solid var(--line); color: var(--text); cursor:pointer; box-shadow: var(--shadow);
      transition: background .2s ease, border .2s ease, transform .06s ease, color .2s ease;
    }
    .btn-logout:hover, .btn-theme:hover{ background: rgba(37,99,235,.08); border-color: rgba(37,99,235,.18); }
    .btn-logout:active, .btn-theme:active{ transform: translateY(1px) }
    .btn-logout svg{ width:18px; height:18px; stroke: currentColor; fill:none; stroke-width:2 }

    /* ===== Botón hamburguesa (móvil) ===== */
    .menu-toggle{
      position: fixed; left:10px; top:10px; z-index:260;
      background:var(--panel); border:1px solid var(--line); color:var(--text);
      border-radius:10px; padding:10px; display:none; box-shadow:var(--shadow); cursor:pointer;
    }
    .menu-toggle svg{ width:20px; height:20px; stroke: currentColor; stroke-width:2; fill:none }

    /* ===== LAYOUT PRINCIPAL ===== */
    .main{
      position:fixed; inset:0 0 0 var(--sb-w);
      width: calc(100svw - var(--sb-w)); height: 100svh; min-height:100vh;
      display:flex; flex-direction:column; overflow: hidden;
      background: linear-gradient(180deg, rgba(238,243,251,.4), transparent 60%);
    }
    .main-header{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px 18px; background: var(--panel); border-bottom:1px solid var(--line);
      box-shadow: 0 10px 26px rgba(15,23,42,.10);
    }
    .main-title{ font-weight:600; letter-spacing:.2px }
    .main-content{
      position:relative; flex:1; padding:16px; overflow:auto;
    }
    .hero-legal{
      position: sticky; bottom: 8px; align-self:center;
      z-index: 2; display: inline-flex; align-items: center; gap: 8px; white-space: nowrap; font-size: 12px; color: var(--muted);
      background: color-mix(in srgb, var(--panel) 82%, transparent);
      padding: 6px 10px; border: none; border-radius:10px; box-shadow: var(--shadow);
      backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);
      margin-top: 12px;
    }

    /* ===== Responsive ≤960px ===== */
    @media (max-width: 960px){
      .menu-toggle{ display:inline-flex }
      .sidebar{ transform: translateX(-100%); transition: transform .25s ease; }
      body.sb-open .sidebar{ transform: translateX(0) }
      body.sb-open .menu-toggle{ left: calc(var(--sb-w) + 18px); }

      .main{ inset:0; width: 100svw; height:auto; min-height:100svh; }
      .main-content{ padding: 12px; }
    }
  </style>
</head>
<body>
  <!-- Botón menú (móvil) -->
  <button class="menu-toggle" id="btnMenu" aria-label="Abrir menú">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </button>

  <!-- ======= SIDEBAR ======= -->
  <aside class="sidebar" id="sidebar" aria-label="Menú lateral">
    <div>
      <div class="sb-brand">
        <div class="sb-logo" title="DOMINION">
          <img src="dominion_logo.png" alt="DOMINION logo">
        </div>
        <div class="sb-title">
          <strong>MinTIC</strong>
          <small>Centros Digitales</small>
        </div>
      </div>

      <div class="sb-section-title">Navegación</div>
      <nav class="sb-nav">
        <a class="sb-item" href="main_page.html">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <line x1="4" y1="12" x2="20" y2="12"></line>
            <polyline points="13 5 20 12 13 19"></polyline>
          </svg>
          <span>Entrar</span>
        </a>

        <a class="sb-item" href="PBI.html">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path class="fill" d="M4 13.5a2 2 0 1 1 4 0V18a2 2 0 1 1-4 0v-4.5Zm5-3a2 2 0 1 1 4 0V18a2 2 0 1 1-4 0V10.5Zm5-2A2 2 0 1 1 19 8v10a2 2 0 1 1-4 0V8.5Z"></path>
          </svg>
          <span>Dashboard</span>
        </a>

        <a class="sb-item" href="inventario_centros_digitales.html">
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <rect x="3" y="4" width="18" height="16" rx="2" ry="2"></rect>
            <line x1="3" y1="10" x2="21" y2="10"></line>
            <line x1="3" y1="15" x2="21" y2="15"></line>
            <rect x="6" y="6" width="4" height="3"></rect>
            <rect x="12" y="6" width="6" height="3"></rect>
            <rect x="6" y="11" width="6" height="3"></rect>
            <rect x="13" y="16" width="5" height="3"></rect>
          </svg>
          <span>Hoja de vida CDs</span>
        </a>

        <a class="sb-item" href="#ayuda" id="btnAyuda">
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <circle cx="12" cy="12" r="9"></circle>
            <path d="M9.5 9.25c.2-1.35 1.35-2.25 2.85-2.25 1.65 0 2.9 1 2.9 2.5 0 1.2-.7 1.9-1.8 2.5-.9.5-1.4 1-1.5 1.8v.4"></path>
            <circle cx="12" cy="16.2" r="1" class="fill"></circle>
          </svg>
          <span>Ayuda</span>
        </a>

        <a class="sb-item" href="#acerca">
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <circle cx="12" cy="12" r="9"></circle>
            <line x1="12" y1="8" x2="12" y2="13"></line>
            <circle cx="12" cy="16" r="1.2" class="fill"></circle>
          </svg>
          <span>Acerca del programa</span>
        </a>

        <!-- >>> NUEVO: Módulo de exclusiones (siempre visible; destino depende del usuario) -->
        <a class="sb-item" id="linkExclusiones" href="#">
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <rect x="3.5" y="4" width="17" height="16" rx="2" ry="2"></rect>
            <polyline points="8 12.5 11 15.5 16.5 9.5"></polyline>
          </svg>
          <span>Módulo de exclusiones</span>
        </a>
        <!-- <<< Fin nuevo ítem -->

        <!-- Manuales -->
        <a class="sb-item" href="manuales.html">
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M4.5 5.5A2.5 2.5 0 0 1 7 3h11a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H7a2.5 2.5 0 0 1-2.5-2.5V5.5Z"></path>
            <path d="M7 3v14.5"></path>
            <line x1="10" y1="7" x2="16" y2="7"></line>
            <line x1="10" y1="10" x2="16" y2="10"></line>
            <line x1="10" y1="13" x2="14" y2="13"></line>
          </svg>
          <span>Manuales</span>
        </a>
      </nav>
    </div>

    <!-- Footer: Cerrar sesión + Tema -->
    <div class="sb-footer">
      <button class="btn-logout" id="btnLogout" type="button" title="Cerrar sesión y volver al inicio de sesión">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M10 12h8"></path>
          <polyline points="15 7 20 12 15 17"></polyline>
          <path d="M14 3H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8"></path>
        </svg>
        <span>Cerrar sesión</span>
      </button>

      <button class="btn-theme" id="btnTheme" type="button" title="Cambiar tema">
        <span id="btnThemeText">Tema: Claro</span>
      </button>
    </div>
  </aside>

  <!-- ======= CONTENIDO PRINCIPAL ======= -->
  <main class="main" role="main">
    <header class="main-header">
      <div class="main-title">Panel principal</div>
      <div style="color:var(--muted); font-size:12px;">
        Usuario: <strong id="currentUserLabel">-</strong>
      </div>
    </header>

    <section class="main-content" id="appContent">
      <!-- Aquí vive tu contenido actual del main_page.html -->
      <!-- Mantengo un placeholder neutro para no alterar tu UI -->
      <div style="padding:8px; color:var(--muted);">
        Bienvenido al módulo principal de Seguimiento O&M.
      </div>
      <div class="hero-legal">
        © 2026 DOMINION — Todos los derechos reservados — WEB desarrollada por Ariel Márquez Rada
      </div>
    </section>
  </main>

  <!-- ===== Scripts ===== -->
  <script>
    /* ========== Tema (Claro/Oscuro) ========== */
    (function(){
      const themeKey = 'landing_theme';
      const docEl = document.documentElement;
      const body  = document.body;
      const btn   = document.getElementById('btnTheme');
      const lbl   = document.getElementById('btnThemeText');

      const applyLabel = (mode)=>{ if (lbl) lbl.textContent = 'Tema: ' + (mode === 'dark' ? 'Oscuro' : 'Claro'); };
      function setMode(mode){
        docEl.setAttribute('data-theme', mode);
        body.classList.toggle('theme-dark', mode==='dark');
        localStorage.setItem(themeKey, mode);
        applyLabel(mode);
      }
      (function initTheme(){
        const saved = localStorage.getItem(themeKey);
        const initial = saved || docEl.getAttribute('data-theme') || 'light';
        setMode(initial);
      })();
      btn?.addEventListener('click', () => {
        const current = (docEl.getAttribute('data-theme')==='dark') ? 'dark' : 'light';
        const next = (current==='dark') ? 'light' : 'dark';
        setMode(next);
      });
    })();

    /* ========== Sidebar móvil (hamburguesa) ========== */
    (function(){
      const btnMenu = document.getElementById('btnMenu');
      btnMenu?.addEventListener('click', ()=>{
        document.body.classList.toggle('sb-open');
      });
    })();

    /* ========== Cerrar sesión ========== */
    (function(){
      document.getElementById('btnLogout')?.addEventListener('click', () => {
        try {
          sessionStorage.removeItem('auth_ok');
          sessionStorage.removeItem('auth_user');
          sessionStorage.removeItem('auth_role');
          sessionStorage.removeItem('welcome_shown');
        } catch(e){}
        window.location.replace('login.html');
      });
    })();

    /* ========== Mostrar usuario actual en el header (informativo) ========== */
    (function(){
      const label = document.getElementById('currentUserLabel');
      if (!label) return;
      const u = (sessionStorage.getItem('auth_user') || '').trim();
      label.textContent = u || '-';
    })();

    /* ========== Enrutamiento del "Módulo de exclusiones" (siempre visible) ========== */
    (function(){
      try{
        const link = document.getElementById('linkExclusiones');
        if (!link) return;

        const ADMIN_URL = 'https://arieltecnologia777-cmd.github.io/Sistema-Integral-OyM-DOMINION-MinTIC/admin_exclusiones.html';
        const USER_URL  = 'https://arieltecnologia777-cmd.github.io/Sistema-Integral-OyM-DOMINION-MinTIC/exclusiones.html';

        // Lista de permitidos: correos completos y locales (incluye "admin")
        const allowedEmails = new Set([
          'jose.delarosa@dominion-global.com',
          'carlos.velasquez@dominion-global.com',
          'analista.mintic@dominion-global.com',
          'katerine.delahoz@dominion-global.com',
          'dayana.jimenez@dominion-global.com',
          'admin@dominion-global.com' // por si el login añade dominio
        ].map(s => s.toLowerCase()));

        const allowedLocals = new Set([
          'jose.delarosa',
          'carlos.velasquez',
          'analista.mintic',
          'katerine.delahoz',
          'dayana.jimenez',
          'admin' // soporta "admin" simple
        ].map(s => s.toLowerCase()));

        const raw = (sessionStorage.getItem('auth_user') || '').trim().toLowerCase();

        // Si viene como "Nombre Apellido <correo>", extrae el correo entre <>
        const emailMatch = raw.match(/<\s*([^>]+)\s*>/);
        const clean = emailMatch ? emailMatch[1].trim() : raw;

        const isEmail = clean.includes('@');
        const localPart = isEmail ? clean.split('@')[0] : clean;

        const isAllowed = allowedEmails.has(clean) || allowedLocals.has(localPart);

        link.href = isAllowed ? ADMIN_URL : USER_URL;

        // Si quieres abrir en pestaña nueva (opcional, sin tocar UI):
        // link.target = '_blank';
        // link.rel = 'noopener';
      }catch(e){
        // Fallback seguro: módulo usuario
        const link = document.getElementById('linkExclusiones');
        if (link){
          link.href = 'https://arieltecnologia777-cmd.github.io/Sistema-Integral-OyM-DOMINION-MinTIC/exclusiones.html';
        }
      }
    })();
  </script>
</body>
</html>

